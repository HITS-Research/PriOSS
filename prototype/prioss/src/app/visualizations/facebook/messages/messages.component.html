<div [ngClass]="{'component-page': !previewMode}">
  <div *ngIf="previewMode">
    <nz-row [nzGutter]="16">
      <nz-col [nzSpan]="16">
        <nz-statistic [nzTitle]="'Number of Interactions'" [nzValue]="totalPeopleMessages" [nzPrefix]="interaction"
          [nzValueStyle]="{display: 'inline-flux'}">
        </nz-statistic>
        <ng-template #interaction>
          <div class="container_class">
            <span nz-icon nzType="comment"></span>
          </div>
        </ng-template>
      </nz-col>
      <nz-col [nzSpan]="16">
        <nz-statistic [nzTitle]="'Groups Interactions'" [nzValue]="totalGroupMessages" [nzPrefix]="location"
          [nzValueStyle]="{display: 'inline-flux'}">
        </nz-statistic>
        <ng-template #location>
          <div class="container_class">
            <span nz-icon nzType="wechat"></span>
          </div>
        </ng-template>
      </nz-col>
    </nz-row>
  </div>
</div>
<div *ngIf="!previewMode">
  <app-title-bar titleText="Messages"
    tooltipText="This visualization presents an overview of data pertaining to interactions with friends and group interactions."></app-title-bar>
  <nz-tabset class="margin-top-20" (nzSelectChange)="onTabSelected($event)">
    <nz-tab nzTitle="People & Friends Interactions - Graph View">
      <ng-container *ngIf="dataAvailableIn; else noDataTemplate">
        <h3 nz-typography>Latest 10 Interactions</h3>
        <h3 nz-typography>Note - Bubble hover shows profile link.</h3>
        <br>
        <div class="timeline_div" class="visualization-card">
          <!-- Creating timeline for complete data -->
          <nz-timeline nzMode="alternate">
            <nz-timeline-item [nzDot]="dotTemplateSignUp" *ngFor="let data of messagesData.slice(0, 10); let i = index">
              <ng-template #dotTemplateSignUp>
                <div class="ant-timeline-item-head ant-timeline-item-head-blue" nz-button nz-popover nzType="primary"
                  [nzPopoverContent]="contentTemplateSignUp" [nzPopoverPlacement]="'leftTop'">
                </div>
              </ng-template>
              <!-- Creating a template to show additional data -->
              <ng-template #contentTemplateSignUp>
                <strong><a href="{{data.uri}}" target="_blank" rel="noopener noreferrer">{{data.name}}</a></strong>
              </ng-template>
              <!-- Showcasing necessary details in timeline -->
              <strong>Name:</strong> {{data.name}}<br>
              <strong>Last Interacted On:</strong> {{ (data.timestamp *1000 | date: 'MMM d, y h:mm a') }}
            </nz-timeline-item>
          </nz-timeline>
        </div>
      </ng-container>
      <ng-template #noDataTemplate>
        <nz-result nzStatus="403" nzTitle="No data available">
        </nz-result>
      </ng-template>
    </nz-tab>
    <nz-tab nzTitle="People & Friends Intercations List">
      <ng-container *ngIf="dataAvailableIn; else noDataTemplate">
        <nz-row [nzGutter]="16">
          <nz-col [nzSpan]="12">
            <nz-statistic [nzValue]="(messagesData.length| number)!"
              [nzTitle]="'Number of People You Have Messaged '"></nz-statistic>
          </nz-col>
          <nz-col [nzSpan]="12">
            <nz-statistic [nzValue]="' ' + (messagesData[0].timestamp * 1000 | date: 'MMM d, y h:mm a')"
              [nzTitle]="'Latest Interaction On '">
            </nz-statistic>
          </nz-col>
        </nz-row>
        <br>
        <div class="search-bar">
          <input type="text" [(ngModel)]="searchText" placeholder="Search..." (input)="filterMessagesItems(searchText)">
          <button class="clear-button" (click)="clearFilterMessages()">Clear</button>
        </div>
        <nz-table [nzData]="filteredMessages" #basicTable>
          <thead>
            <tr>
              <th nzCustomFilter class="tableCol">Contact Name</th>
              <th nzCustomFilter class="tableCol">Last Interacted On</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of basicTable.data">
              <td>{{ data.name }}</td>
              <td>{{ data.timestamp *1000 | date: 'MMM d, y h:mm a'}}</td>
            </tr>
          </tbody>
        </nz-table>
      </ng-container>
      <ng-template #noDataTemplate>
        <nz-result nzStatus="403" nzTitle="No data available">
        </nz-result>
      </ng-template>
    </nz-tab>
    <nz-tab nzTitle="Group Interactions - Graph View ">
      <ng-container *ngIf="dataAvailableGroup; else noDataTemplate">
        <h3 nz-typography>Latest 10 Interactions</h3>
        <br>
        <div class="chart-container">
          <svg class="chart" id="chart"></svg>
        </div>
      </ng-container>
      <ng-template #noDataTemplate>
        <nz-result nzStatus="403" nzTitle="No data available">
        </nz-result>
      </ng-template>
    </nz-tab>
    <nz-tab nzTitle="Group Interaction List">
      <ng-container *ngIf="dataAvailableGroup; else noDataTemplate">
        <nz-row [nzGutter]="16">
          <nz-col [nzSpan]="12">
            <nz-statistic [nzValue]="(groupMessagesData.length| number)!"
              [nzTitle]="'Number of Groups You Have Interacted '"></nz-statistic>
          </nz-col>
        </nz-row>
        <div class="Group Interaction List">
          <h2>Group Interaction List</h2>
          <div class="search-bar">
            <input type="text" [(ngModel)]="searchText" placeholder="Search..."
              (input)="filterGroupMessagesItems(searchText)">
            <button class="clear-button" (click)="clearFilterGroupMessages()">Clear</button>
          </div>
          <ul>
            <li class="list-item" *ngFor="let item of getVisibleData()">{{ item.name }}</li>
          </ul>
          <div class="pagination">
            <button class="page-btn" [disabled]="groupCurrentPage === 1"
              (click)="goToGroupPage(groupCurrentPage - 1)">Previous</button>
            <span class="page-info">{{ groupCurrentPage }} / {{ groupTotalPages }}</span>
            <button class="page-btn" [disabled]="groupCurrentPage === groupTotalPages"
              (click)="goToGroupPage(groupCurrentPage + 1)">Next</button>
          </div>
        </div>

      </ng-container>
      <ng-template #noDataTemplate>
        <nz-result nzStatus="403" nzTitle="No data available">
        </nz-result>
      </ng-template>
    </nz-tab>
    <ng-template #noDataTemplate>
      <nz-result nzStatus="403" nzTitle="No data available">
      </nz-result>
    </ng-template>

  </nz-tabset>
</div>